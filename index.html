<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suneel HI-TECH | Manufacturing with Precision</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <style>
        /* Set Inter font */
        :root {
            font-family: "Inter", sans-serif;
        }

        /* --- THEME CUSTOM PROPERTIES (CSS VARIABLES) --- */
        /* Default: DARK THEME */
        :root {
            --bg-base: #1a1a1a;
            --bg-app-overlay: rgba(17, 24, 39, 0.5);
            --bg-card-dark: rgba(17, 24, 39, 0.7);
            --bg-card-light: rgba(17, 24, 39, 0.4);
            --color-primary: #f3f4f6;
            --color-secondary: #9ca3af;
            --color-accent: #ff9933;
            /* Saffron/Orange */
            --color-accent-dark: #cc7a00;
            --color-accent-glow: rgba(255, 153, 51, 0.9);
            --border-color: #374151;
            --shadow-color: rgba(155, 154, 154, 0);
            --logo-color: #ffffff;
            --glass-border: rgba(0, 255, 255, 0.1);
            /* Cyan border on glass */
        }

        /* LIGHT THEME Overrides (FIXED OPACITY FOR TRANSPARENCY & NEW LIGHT GRAY BG) */
        .light-theme {
            --bg-base: #e5e7eb;
            /* Light Gray Background */
            --bg-app-overlay: rgba(255, 255, 255, 0.7);
            /* Card with Denser Background (Header/Main Content Block) */
            --bg-card-dark: rgba(240, 240, 240, 0.5);
            /* Whiter base, 50% opacity */
            --bg-card-light: rgba(255, 255, 255, 0.35);
            /* White base, 35% opacity */
            --color-primary: #1f2937;
            --color-secondary: #4b5563;
            --color-accent: #ff9933;
            /* Saffron/Orange */
            --color-accent-dark: #c45b00;
            /* Darker Orange */
            --color-accent-glow: rgba(255, 153, 51, 0.9);
            --border-color: #d1d5db;
            --shadow-color: rgba(0, 0, 0, 0);
            --logo-color: #1f2937;
            --glass-border: rgba(0, 0, 0, 0.2);
        }

        /* --- CORE APP STRUCTURE FIX --- */
        /* 1. Body and App Container are FIXED height with NO native scroll */
        body {
            overflow: hidden;
            /* Prevent body scrolling */
            height: 100vh;
            /* Fixed viewport height */
            background-color: var(--bg-base);
            position: relative;
            cursor: crosshair;
            color: var(--color-primary);
        }

        #app-container {
            height: 100vh;
            /* Fixed viewport height */
            display: flex;
            flex-direction: column;
            background-color: var(--bg-app-overlay);
        }

        /* 2. Scrollable Viewport is between Header and Footer */
        #main-scroll-view {
            /* Use flex-grow to take up all remaining space */
            flex-grow: 1;
            /* Enable scrolling ONLY in this area */
            overflow-y: auto;
            overflow-x: hidden;
            /* Set base stacking context for all content */
            position: relative;
            z-index: 10;
            padding-bottom: 24px;
            /* Ensure content doesn't touch the bottom edge of this container */
        }

        /* --- END CORE APP STRUCTURE FIX --- */


        /* 1. Canvas Styling */
        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            pointer-events: none;
        }

        /* Custom Saffron Color Palette - Use variables for dynamic colors */
        .saffron {
            background-color: var(--color-accent);
        }

        .saffron-text {
            color: var(--color-accent);
        }

        .green-accent {
            background-color: #138808;
        }

        /* --- Liquid Glass / Frosted Effect --- */
        .liquid-glass {
            background-color: var(--bg-card-light);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid var(--glass-border);
            color: var(--color-primary);
        }

        .translucent-card-light {
            @apply liquid-glass;
            /* Light cards use the base light glass BG */
        }

        .translucent-card-dark {
            /* Header/Heavy elements use the dark card BG variable */
            background-color: var(--bg-card-dark);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid var(--glass-border);
            color: var(--color-primary);
        }

        /* --- Glass Text Effect (Glow REMOVED for accessibility) --- */
        .glass-text {
            color: var(--color-primary);
            /* Preserve readability in dark mode without glow */
            text-shadow: 2px 2px 3px var(--shadow-color);
            font-weight: 800;
        }

        /* MODIFIED: Used for the main header logo */
        .saffron-glass-text {
            color: var(--color-accent);
            /* Preserve readability in dark mode without glow */
            text-shadow: 2px 2px 3px var(--shadow-color);
            font-weight: 900;
        }


        /* Utility for secondary text color */
        .text-secondary {
            color: var(--color-secondary);
        }

        /* Client logos adjust their background color */
        .client-logo {
            background-color: var(--bg-card-dark);
            color: var(--color-accent);
            border: 1px solid var(--border-color);
        }

        /* Nav link colors */
        .nav-btn {
            color: var(--color-secondary);
        }

        /* FIX 1: Ensure active link style is applied correctly to Desktop Nav */
        .nav-btn.active-link {
            color: var(--color-accent) !important;
            font-weight: 700;
            /* Bolder for active tab */
        }

        /* --- INTERACTIVE CARD HOVER EFFECT --- */
        .interactive-card {
            /* Set perspective for 3D transforms to work */
            perspective: 1000px;
            /* MODIFIED: Increased transition duration and added custom easing for smooth, organic feel */
            transition: box-shadow 0.4s ease-out,
                transform 0.3s cubic-bezier(0.2, 0.8, 0.4, 1.2);
            /* Reset transform properties for the transition */
            transform: rotateX(0deg) rotateY(0deg) translateZ(0) translateY(0);
            /* Needed for Z-index stacking on hover */
            position: relative;
            z-index: 1;
        }

        /* Apply a base shadow and glow when the card is active/hovered (JS will handle the tilt/lift) */
        .interactive-card:hover {
            /* Custom glow using the accent color */
            box-shadow: 0 10px 40px var(--shadow-color),
                0 0 20px 5px rgba(255, 153, 51, 0.4);
            /* Saffron glow */
            z-index: 10;
            /* Ensure the hovered card is above its neighbors */
        }

        /* --- CLIENT BILLBOARD (CSS INFINITE SCROLL) --- */
        .client-billboard-container {
            /* Hide scrollbars and contain movement */
            overflow: hidden;
            width: 100%;
            pointer-events: none;
            /* Disable interaction */
        }

        /* Define the duration based on speed config (using a large multiplier for smooth movement) */
        :root {
            --billboard-scroll-duration: 20s;
            --cert-scroll-duration: 15s;
            /* Shorter duration for fewer items */
        }

        /* GENERAL BILLBOARD TRACK STYLES */
        .billboard-track {
            display: flex;
            width: fit-content;
        }

        /* CLIENT BILLBOARD SPECIFIC */
        .client-billboard-track {
            animation: billboard-scroll var(--billboard-scroll-duration) linear infinite;
        }

        .client-billboard-track:hover {
            animation-play-state: paused;
            /* Pause on hover for accessibility/inspection */
        }

        /* CERTIFICATION BILLBOARD SPECIFIC */
        .cert-billboard-track {
            animation: cert-billboard-scroll var(--cert-scroll-duration) linear infinite;
        }

        .cert-billboard-track:hover {
            animation-play-state: paused;
        }


        .billboard-item {
            /* FIX 3: Set size to 180x180 to match original upload for consistency */
            flex-shrink: 0;
            width: 180px;
            height: 180px;
            margin-right: 24px;

            /* Base styling for the card container */
            display: flex;
            align-items: center;
            justify-content: center;

            /* Inherit styling from client card (optional, but good practice) */
            background-color: var(--bg-card-dark);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;

            /* Disable any pointer events on the items */
            pointer-events: none;
            cursor: default;

            transition: none;
            transform: none;
            opacity: 1;
            z-index: 1;
        }

        /* Adjust size for certification items to fit better with content */
        .cert-billboard .billboard-item {
            /* FIX 3: Cert size to 180x180 */
            width: 180px;
            height: 180px;
            margin-right: 24px;
        }

        .billboard-item-content {
            /* Inner content styling */
            padding: 0.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* FIX: Use primary color variable for text visibility on both themes */
            color: var(--color-primary);
        }

        .billboard-image {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 0.5rem;
        }

        /* Cert-specific image/content layout (Adjusted for 180x180 item size) */
        .cert-billboard .billboard-image {
            width: 80px;
            height: 80px;
            margin-bottom: 0.5rem;
            margin-right: 0;
        }

        .cert-billboard .billboard-item-content {
            flex-direction: column;
            /* Reverted to column for larger logo */
            width: 100%;
            height: 100%;
        }

        /* Client-specific image/content layout (Adjusted for 180x180 item size) */
        .client-billboard .billboard-image {
            width: 80px;
            height: 80px;
        }

        .client-billboard .billboard-item-content {
            flex-direction: column;
            width: 100%;
            height: 100%;
        }


        @keyframes billboard-scroll {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(var(--billboard-total-width-negative));
            }
        }

        @keyframes cert-billboard-scroll {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(var(--cert-billboard-total-width-negative));
            }
        }

        /* --- END CLIENT BILLBOARD --- */

        /* --- PRODUCT/INDEXED CAROUSEL STYLES (TRADITIONAL SCROLL VIEW) --- */

        .indexed-carousel-container {
            position: relative;
            width: 100%;
            height: var(--carousel-height, 350px);
            /* Use CSS variable for height */
            margin-top: 1rem;

            /* KEY CHANGE: Enable Horizontal Scrolling */
            overflow-x: scroll;
            overflow-y: hidden;

            /* Visual gutter padding */
            padding: 0 20px;

            /* Smooth scrolling and snap-to-card behavior */
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;

            /* Hide scrollbar on supported browsers */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .indexed-carousel-container::-webkit-scrollbar {
            display: none;
        }

        /* NEW: Styles for the large (400x400) cert carousels (Client removed) */
        #cert-carousel-container {
            /* Removed since it's now a billboard */
        }

        /* STATIC PRODUCT VIEW STYLES */
        /* Removed scroll/snap for the main product view */
        /* REVERTED: Now dynamic again. Restored scroll-snap and overflow-x. */
        #main-carousel-container {
            overflow-x: scroll;
            padding: 0 20px;
            height: 350px;
        }

        /* Reverted card styles for the main product view (back to scrolling behavior) */
        #main-carousel-container .carousel-card {
            flex-shrink: 0;
            height: 340px;
            width: var(--card-width, 85%);
            margin-right: 30px;
            scroll-snap-align: center;
            opacity: 0.7;
            transform: scale(1);
        }

        /* Ensure dynamic content shows up in the carousel card container (for Products tab) */
        .carousel-track {
            position: relative;
            top: 0;
            left: 0;
            height: 100%;
            display: flex;
            align-items: center;
            transition: none;
        }

        .carousel-card {
            flex-shrink: 0;
            height: var(--card-height, 340px);
            /* Use CSS variable for card height */
            width: var(--card-width, 85%);
            /* Use CSS variable for card width */

            margin-right: 30px;
            scroll-snap-align: center;

            transition: opacity 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
            opacity: 0.7;
            transform: scale(1);
            cursor: pointer;
            overflow: hidden;
        }

        /* Specific sizing for client/cert cards (These still scroll) */
        #client-carousel-container .carousel-card,
        #cert-carousel-container .carousel-card {
            --card-width: 400px;
            --card-height: 400px;
            margin-right: 24px;
        }

        .carousel-card.active {
            opacity: 1;
            transform: scale(1.02);
            z-index: 10;
            cursor: default;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .carousel-card-inner {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* Default Product Carousel Layout (50/50 split remains) */
        #main-carousel-container .card-image-section {
            width: 50%;
        }

        #main-carousel-container .card-desc-section {
            display: flex;
            width: 50%;
        }

        /* Client/Cert Carousel Layout (Full width image, no desc section) */
        #client-carousel-container .card-image-section,
        #cert-carousel-container .card-image-section {
            width: 100%;
        }

        #client-carousel-container .card-desc-section,
        #cert-carousel-container .card-desc-section {
            display: none;
        }

        .card-image-section {
            position: relative;
            overflow: hidden;
        }

        .card-image-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease-out;
        }

        .carousel-card:hover .card-image-section img {
            transform: scale(1.05);
        }

        .card-title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        }

        .card-desc-section {
            padding: 1.5rem;
            flex-direction: column;
            justify-content: center;
            background-color: var(--bg-card-dark);
        }

        /* --- END PRODUCT/INDEXED CAROUSEL STYLES --- */

        /* --- PRODUCT SUB-TAB STYLES (REVISED) --- */
        .product-sub-tab {
            /* 1. Increased Size and Padding */
            @apply text-base font-semibold px-4 py-2 min-w-32 text-center relative overflow-hidden;
            /* 2. Equal Width, Permanent Border, Base Colors */
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--color-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.25s ease-out;
            transform: scale(1);
        }

        /* Hover effect for inactive tabs */
        .product-sub-tab:not(.active):hover {
            background-color: rgba(255, 255, 255, 0.15);
            color: var(--color-primary);
            transform: scale(1.03);
            border-color: var(--color-primary);
        }

        .product-sub-tab.active {
            /* 4. Use a Thick Bottom Highlight/Indicator */
            background-color: var(--bg-card-dark);
            color: var(--color-accent) !important;
            border-color: var(--color-accent);
            /* Border is accent color */
            box-shadow: 0 0 10px rgba(255, 153, 51, 0.4);
            transform: scale(1.05);
        }

        /* --- END PRODUCT SUB-TAB STYLES --- */

        /* --- LOADER BAR STYLES --- */
        .loading-bar-wrapper {
            width: 80%;
            max-width: 400px;
            height: 4px;
            margin: 1rem auto 0;
            position: relative;
        }

        .loading-bar-container {
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: absolute;
            transition: opacity 0.3s ease;
        }

        .loading-bar-fill {
            height: 100%;
            background-color: var(--color-accent);
            width: 0%;
            border-radius: 2px;
            animation-name: fill-bar;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }

        /* Pause indicator (Sand Timer) */
        .pause-indicator {
            position: absolute;
            top: -10px;
            /* Adjust to center vertically with bar */
            left: 50%;
            transform: translateX(-50%);
            color: var(--color-accent);
            font-size: 24px;
            /* Larger icon */
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .pause-indicator.show {
            opacity: 1;
        }

        @keyframes fill-bar {
            from {
                width: 0%;
            }

            to {
                width: 100%;
            }
        }

        /* --- END LOADER BAR STYLES --- */

        /* --- MAIN TAB STYLES (REVISED for prominence and readability) --- */
        .main-tab-btn {
            /* 1. Increased Font Size (text-2xl) and Padding (py-6) for prominence and vertical space (FIXING OVERLAP) */
            @apply px-8 py-6 text-2xl font-bold transition-all duration-200 -mb-[1px] relative z-0;

            /* 2. Fixed Width (min-w-44 ~ 11rem) for equal size and wider look */
            min-width: 11rem;

            border: 1px solid var(--border-color);
            border-bottom: none;
            color: var(--color-secondary);

            /* 3. Opaque Background for inactive state */
            background-color: rgba(0, 0, 0, 0.4);

            border-radius: 8px 8px 0 0;
            margin-right: 2px;
        }

        .main-tab-btn:hover {
            color: var(--color-primary);
            background-color: rgba(255, 255, 255, 0.2);
            /* Slightly lighter on hover */
        }

        .main-tab-btn.active {
            color: var(--color-accent);
            background-color: var(--bg-card-dark);
            /* Match the panel background below */
            border-color: var(--border-color);
            z-index: 1;
            /* Make it overlap the border-bottom below it */
            /* Increased bottom highlight to -8px for better visibility and clearance */
            box-shadow: inset 0 -3px 0 0 var(--color-accent);
        }

        /* Hide the bottom border of the tab container so the active tab can overlap it */
        .main-tab-container-border {
            border-color: var(--border-color);
            border-bottom-width: 1px;
        }

        /* --- END MAIN TAB STYLES --- */

        /* --- NAVIGATION STICKY SETUP --- */

        /* Header/Desktop Nav: Fixed to the top when scrolling */
        header {
            position: sticky;
            top: 0;
            z-index: 2147483647;
            /* MAX Z-INDEX to ensure it's always on top */
            /* Remove background-color override, rely solely on translucent-card-dark */
            /* background-color: var(--bg-card-dark) !important; */
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            backdrop-filter: blur(12px) saturate(180%);
        }

        /* Mobile Bottom Nav: Fixed to the bottom (already set in HTML using 'fixed' equivalent styles) */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 2147483647;
            /* MAX Z-INDEX for consistency */
        }

        /* --- MOBILE NAVIGATION BUTTON STYLING --- */
        #bottom-nav .nav-btn {
            /* 1. Use flex-grow, set font style, and add a subtle divider */
            @apply flex-grow h-full flex flex-col items-center justify-center font-semibold text-sm relative;
            /* 2. Add a transition for smooth visual feedback */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }

        /* 3. Add a divider to the right of each button, except the last one */
        #bottom-nav .nav-btn:not(:last-child)::after {
            content: '';
            @apply absolute top-1/4 right-0 h-1/2 w-px bg-gray-600;
        }

        /* 3. Style for the ACTIVE mobile navigation button */
        #bottom-nav .nav-btn.active-link {
            /* Use a slightly lighter, semi-transparent background to indicate selection */
            background-color: rgba(255, 255, 255, 0.1);
            /* Add a saffron-colored top border as a highlight */
            border-top: 4px solid var(--color-accent);
            /* Ensure the icon and text color match the accent color */
            color: var(--color-accent);
        }

        /* --- LOGO/TITLE FLEX CONTAINER --- */
        #logo-title-group {
            /* Base: flex-col (vertical stack) */
            /* We use flex-wrap here so the tagline drops if it runs out of space */
            @apply flex flex-wrap justify-start items-center;
        }

        /* Ensure the brand name is the first item to stay on one line on desktop */
        #brand-name {
            @apply flex-shrink-0;
        }

        /* Ensure the tagline is allowed to wrap */
        #tagline {
            @apply flex-shrink;
        }

        @media (min-width: 768px) {
            #logo-title-group {
                /* Desktop: force horizontal alignment and no wrap */
                @apply flex-nowrap flex-row items-baseline;
            }
        }

        /* Responsive styles remain the same */
        @media (max-width: 768px) {
            #bottom-nav {
                display: flex;
            }

            #desktop-nav {
                display: none;
            }

            /* REMOVED: .page-content padding is now unnecessary because the scroll container handles the offset */
        }

        @media (min-width: 769px) {
            #bottom-nav {
                /* Override position:fixed on mobile and set to fixed to bottom of app-container */
                position: initial;
                display: none;
            }

            #desktop-nav {
                display: flex;
            }

            /* REMOVED: .page-content padding is now unnecessary */
        }
    </style>
    <!-- Icons from Lucide -->
    <script type="module">
        // FIX: Explicitly import all required icons to prevent SyntaxError with CDN import.
        import {
            createIcons,
            Home,
            User,
            Mail,
            Sun,
            Moon,
            Hourglass,
        } from "https://unpkg.com/lucide@latest";

        // NOTE: window.lucide is no longer required as icons are passed directly to createIcons.

        // Initial creation of navigation icons and utility icons
        const icons = {
            Home: Home,
            User: User,
            Mail: Mail,
            Sun: Sun,
            Moon: Moon,
            Hourglass: Hourglass,
        };

        // Expose icons and createIcons globally for use in the script below (like theme switching)
        window.lucide = {
            createIcons: createIcons,
            ...icons,
        };

        // Render all icons on load
        createIcons({ icons: icons });
    </script>
</head>

<body class="antialiased">
    <!-- CANVAS ELEMENT FOR TRON-STYLE BACKGROUND ANIMATION -->
    <canvas id="backgroundCanvas"></canvas>

    <div id="app-container" class="max-w-7xl mx-auto shadow-2xl border-x" style="border-color: var(--border-color)">
        <!-- Header & Desktop Navigation (Sticky Top) -->
        <header
            class="p-4 flex flex-col md:flex-row items-center justify-between border-b shadow-lg z-10 translucent-card-dark"
            style="border-color: var(--border-color)">
            <div class="flex items-center space-x-3 w-full md:w-auto">
                <!-- Logo Image -->
                <div class="h-12 items-center justify-center p-1 aspect-square">
                    <img src="assets/logo.png" alt="SUNEEL HI-TECH Logo" class="w-full h-full"
                        onerror="this.onerror=null; this.src='https://placehold.co/32x32/FF9933/ffffff?text=SH';"
                        style="background-color: transparent;">
                </div>

                <!-- Vertically Aligned Brand Name and Tagline -->
                <div class="flex flex-col">
                    <h1 class="text-4xl saffron-glass-text whitespace-nowrap">
                        SUNEEL HI-TECH
                    </h1>
                    <h1 class="text-xl glass-text whitespace-nowrap">
                        Manufacturing with Precision
                    </h1>
                </div>
            </div>

            <div class="flex items-center space-x-6 w-full md:w-auto justify-end md:justify-start mt-2 md:mt-0">
                <!-- Desktop Navigation -->
                <nav id="desktop-nav" class="hidden md:flex space-x-6 text-lg font-medium">
                    <button data-page="home" class="nav-btn transition duration-150 py-2 active-link">
                        <strong>Home</strong>
                    </button>
                    <button data-page="about" class="nav-btn hover:text-orange-600 transition duration-150 py-2">
                        <strong>About Us</strong>
                    </button>
                    <button data-page="products" class="nav-btn hover:text-orange-600 transition duration-150 py-2">
                        <strong>Products</strong>
                    </button>
                    <button data-page="contact" class="nav-btn hover:text-orange-600 transition duration-150 py-2">
                        <strong>Contact</strong>
                    </button>
                </nav>

                <!-- THEME TOGGLE SWITCH CONTAINER -->
                <button id="theme-toggle" class="p-2 rounded-full border transition duration-300" style="
							color: var(--color-accent);
							border-color: var(--border-color);
						">
                    <!-- Default icon is SUN (for Dark Theme), which indicates the switch TO Light Mode -->
                    <i data-lucide="sun" class="w-5 h-5" id="theme-icon"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area - NOW CONTAINS THE SCROLLING VIEWPORT -->
        <div id="main-scroll-view">
            <main id="content-area">
                <!-- Home Page -->
                <section id="page-home" class="page-content p-6">
                    <!-- Inner card maintains dark background to contrast with light inner elements -->
                    <div
                        class="translucent-card-dark p-8 rounded-xl shadow-lg mb-6 interactive-card hover:cursor-default">
                        <!-- Slogan: MODIFIED from saffron-glass-text (orange) to glass-text (white/light gray) -->
                        <h2 class="text-2xl mb-4 glass-text">
                            Manufacturer of Plastic Moulding & Metal Stamping Components
                        </h2>
                        <p class="text-lg font-light text-secondary">
                            An ISO 9001: 2015 Certified Company
                        </p>
                        <div
                            class="mt-4 inline-block px-4 py-1 text-sm font-semibold rounded-full bg-white text-gray-900 border-2 border-green-accent">
                            üáÆüá≥ MAKE IN INDIA
                        </div>
                    </div>

                    <!-- Inner content area is set to light backgrounds for text readability -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="translucent-card-light p-4 rounded-lg shadow-md home-panel interactive-card">
                            <!-- Heading: MODIFIED to text-2xl (same as before) and glass-text (white/light gray) -->
                            <h3 class="text-2xl mb-3 border-l-4 border-orange-500 pl-3 glass-text">
                                Introduction
                            </h3>
                            <p class="mb-4 text-secondary" style="text-align: justify">
                                SUNEEL Hi-Tech was established in 1998 at Pune by visionary
                                entrepreneur
                                <span class="font-bold">Mr. Suneel Gulab Singh</span>. Over the
                                last two decades we have grown and recognized as a ‚ÄúPreferred
                                Supplier‚Äù for Special Projects.
                            </p>
                            <p class="mb-4 text-secondary" style="text-align: justify">
                                We started our journey with Indian Railways Controller of Stores
                                (COS) and Signal- Telecom (S&amp;T) Projects. Further we
                                expanded to Automotive Industries as Manufacturers and Exporters
                                of Plastic and Electro-Mechanical products.
                            </p>
                            <p class="text-secondary" style="text-align: justify">
                                We have developed our core team of Engineers along with network
                                of reliable suppliers and expert consultants to undertake
                                complex, stringent quality &amp; accuracy demanding projects. We
                                are open to explore potential opportunities through joint
                                ventures partnerships.
                            </p>
                        </div>
                        <div class="translucent-card-light p-4 rounded-lg shadow-md home-panel interactive-card">
                            <!-- Heading: MODIFIED to text-xl and glass-text (white/light gray) -->
                            <h3 class="text-xl mb-3 border-l-4 border-orange-500 pl-3 glass-text">
                                Core Expertise
                            </h3>
                            <ul class="space-y-2 list-disc list-inside text-secondary">
                                <li>
                                    <span class="font-medium">Railway Signalling:</span> MSDAC,
                                    IPS, Electronic Interlocking (EI).
                                </li>
                                <li>
                                    <span class="font-medium">Materials:</span> Nylon, PBT, PC,
                                    TPU, Phenolic Moulding Powder.
                                </li>
                                <li>
                                    <span class="font-medium">Stamping:</span> Brass, Copper,
                                    Phosphorus Bronze, Soft Iron.
                                </li>
                                <li>
                                    <span class="font-medium">Quality:</span> Meeting highest
                                    standards accepted by IS, ISO & RDSO.
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-6 translucent-card-light p-4 rounded-lg shadow-md home-panel interactive-card">
                        <h3 class="text-2xl mb-3 border-l-4 border-orange-500 pl-3 glass-text">Our Esteemed Clients</h3>

                        <!-- START: CLIENTS BILLBOARD (CSS Infinite Scroll) -->
                        <div id="client-billboard-wrapper" class="client-billboard-container client-billboard">
                            <div id="client-billboard-track" class="billboard-track client-billboard-track"
                                style="animation-duration: var(--billboard-scroll-duration);">

                                <!-- Placeholder for Content, populated by JS -->
                                <!-- The items will be cloned to create the loop -->

                            </div>
                        </div>
                        <!-- END: CLIENTS BILLBOARD -->
                    </div>
                </section>

                <!-- About Us Page -->
                <section id="page-about" class="page-content p-6 hidden">
                    <div class="translucent-card-light p-6 rounded-xl shadow-lg about-panel interactive-card">
                        <!-- Heading: MODIFIED from saffron-glass-text (orange) to glass-text (white/light gray) -->
                        <h2 class="text-2xl mb-4 border-b pb-2 glass-text" style="border-color: var(--border-color)">
                            About SUNEEL HI-TECH
                        </h2>
                        <!-- MODIFIED: Changed layout from vertical stack to a 2-column grid -->
                        <div class="grid md:grid-cols-2 gap-6 space-y-6 md:space-y-0">
                            <!-- Left Column: Infrastructure (takes full height) -->
                            <div class="p-5 rounded-xl shadow-sm translucent-card-dark interactive-card">
                                <h3 class="text-xl glass-text mb-2 flex items-center">
                                    <span class="mr-2 saffron-text">üî®</span> Infrastructure
                                </h3>

                                <p class="mb-4 text-secondary">
                                    We have developed state of the art facilities equipped with
                                    latest <span class="font-bold">Injection moulding</span> and <span class="font-bold">Pneumatic High Speed Power
                                    Press </span> > along with full fledge Tool Room, R&amp;D and Quality
                                    Testing lab.
                                </p>

                                <ul class="space-y-2 list-disc list-inside text-secondary">
                                    <li>Milacron Injection Moulding Machine 80 to 150 Ton.</li>
                                    <li>Pneumatic High Speed Power Press 10 Ton to 63 Ton</li>
                                    <li>Compression Moulding Machine 200 Ton</li>
                                    <li>Ultrasonic Welding machine</li>
                                    <li>Hot Runner Temperature Control</li>
                                    <li>Hopper Dryer with max temp 180¬∞ C</li>
                                    <li>Hot Air Annealing Oven with max temp. 180¬∞C</li>
                                    <li>Mould Temperature Controller with max temp 180¬∞C</li>
                                    <li>Semi-Automatic Band Saw Machine</li>
                                    <li>Milling Cum Drilling machine</li>
                                    <li>Lathe Machine</li>
                                    <li>Drill Machine</li>
                                </ul>
                            </div>

                            <!-- Right Column: Vision and Mission (stacked vertically) -->
                            <div class="flex flex-col space-y-6">
                                <div class="p-5 rounded-xl shadow-sm translucent-card-dark interactive-card">
                                    <h3 class="text-xl glass-text mb-2 flex items-center">
                                        <span class="mr-2 saffron-text">‚≠ê</span> Vision
                                    </h3>
                                    <p class="text-secondary">
                                        To establish ourselves as a customer-centric organization
                                        with a focused approach to deliver best quality products
                                        with cutting-edge solutions to meet and exceed the
                                        expectations of our clients.
                                    </p>
                                </div>
                                <div class="p-5 rounded-xl shadow-sm translucent-card-dark interactive-card">
                                    <h3 class="text-xl glass-text mb-2 flex items-center">
                                        <span class="mr-2 saffron-text">üöÄ</span> Mission
                                    </h3>
                                    <p class="text-secondary">
                                        To constantly improve ourselves, along with the products and
                                        services provided, so as to become the best and most
                                        preferred supplier in our industry segments.
                                    </p>
                                </div>
                                <div class="p-5 rounded-xl shadow-sm translucent-card-dark interactive-card">
                                    <h3 class="text-xl glass-text mb-2 flex items-center">
                                        <span class="mr-2 saffron-text">üéì</span> Director's Message
                                    </h3>
                                    <p class="text-secondary">
                                        We take this opportunity to thank our valued customers,
                                        whose continued patronage and confidence in our products
                                        inspires us to extend the best of services and enable us to
                                        provide value for their money. We are committed to total
                                        consumer satisfaction by identifying their specific needs,
                                        translating them into Quality products. We strive hard &amp;
                                        always look forward to achieve the desired results by
                                        adopting &amp; implementing our Core Values at all level. We
                                        therefore, seek continued patronage of our valued customers,
                                        cooperation of our employees and thank our well-wishers who
                                        have contributed to the growth of the organisation.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Certifications section remains full width below the 2-column grid -->
                        <h3 class="text-2xl glass-text mt-8 border-l-4 border-orange-500 pl-3">
                            Certifications & Infrastructure
                        </h3>
                        <!-- START: CERTIFICATIONS BILLBOARD (CSS Infinite Scroll) -->
                        <div id="cert-billboard-wrapper" class="client-billboard-container cert-billboard">
                            <div id="cert-billboard-track" class="billboard-track cert-billboard-track"
                                style="animation-duration: var(--cert-scroll-duration);">

                                <!-- Placeholder for Content, populated by JS -->

                            </div>
                        </div>
                        <!-- END: CERTIFICATIONS BILLBOARD -->
                    </div>
                </section>

                <!-- Products Page -->
                <section id="page-products" class="page-content p-6 hidden">
                    <div class="p-6 rounded-xl shadow-lg">
                        <!-- Heading: MODIFIED from saffron-glass-text (orange) to glass-text (white/light gray) -->
                        <h2 class="text-2xl mb-4 border-b pb-2 glass-text" style="border-color: var(--border-color)">
                            Product Catalogue
                        </h2>
                        <p class="mb-6 text-secondary">
                            We specialize in components for Indian Railways and high-standard
                            Industrial/Automotive applications.
                        </p>

                        <!-- Main Product Category Tabs -->
                        <div class="flex main-tab-container-border">
                            <button data-tab="em" class="main-tab-btn active">
                                Electro-Mechanical
                            </button>
                            <button data-tab="poly" class="main-tab-btn">Polymer</button>
                        </div>

                        <!-- CENTRAL DYNAMIC PRODUCT PANEL -->
                        <div id="product-tab-content">
                            <div id="tab-panel-main" class="tab-content-panel">
                                <div
                                    class="bg-gray-100/5 p-4 rounded-b-xl rounded-tr-xl translucent-card-dark relative">

                                    <!-- Loader Overlay -->
                                    <div id="carousel-loader" class="show">
                                        <svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg"
                                            fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                            </path>
                                        </svg>
                                    </div>

                                    <!-- Dynamic Header/Details Area -->
                                    <div id="dynamic-product-details">
                                        <h3 class="text-xl glass-text mb-3 flex items-center">
                                            <span class="mr-2 text-red-500" id="category-icon">‚öôÔ∏è</span>
                                            <span id="category-title">Electro-Mechanical Components</span>
                                        </h3>
                                        <p class="text-sm mb-4 text-secondary" id="category-subtitle">
                                            Q Series Railway Signalling Relays Spare parts and other
                                            essential metal components.
                                        </p>

                                        <!-- Sub-tabs for Product Set -->
                                        <div id="sub-tabs" class="flex flex-wrap gap-3 justify-center mb-4"></div>
                                    </div>

                                    <!-- Central DYNAMIC Product Display -->
                                    <div id="main-carousel-container" class="indexed-carousel-container">
                                        <div id="main-carousel-track" class="carousel-track">
                                            <!-- All Cards will be rendered here and scrolled -->
                                        </div>
                                    </div>

                                    <!-- Loader Bar Wrapper (RESTORED) -->
                                    <div id="main-loading-bar-wrapper" class="loading-bar-wrapper">
                                        <!-- The actual progress bar -->
                                        <div id="main-loading-bar" class="loading-bar-container">
                                            <div class="loading-bar-fill"></div>
                                        </div>
                                        <!-- The pause indicator (Hourglass/Sand Timer) -->
                                        <div id="pause-indicator" class="pause-indicator">
                                            <i data-lucide="hourglass" class="w-6 h-6 animate-spin-slow"></i>
                                        </div>
                                    </div>

                                    <!-- RESTORED: Horizontal rule and list containers -->
                                    <hr class="my-6 border-gray-600" />
                                    <ul id="category-list"
                                        class="grid grid-cols-2 gap-x-4 gap-y-1 text-sm text-secondary">
                                    </ul>
                                    <p class="text-xs text-secondary mt-2" id="category-materials">
                                    </p>
                                    <!-- END RESTORED -->

                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Contact Page -->
                <section id="page-contact" class="page-content p-6 hidden">
                    <div class="translucent-card-light p-6 rounded-xl shadow-lg contact-panel interactive-card">
                        <!-- Heading: MODIFIED from saffron-glass-text (orange) to glass-text (white/light gray) -->
                        <h2 class="text-2xl mb-4 border-b pb-2 glass-text" style="border-color: var(--border-color)">
                            Get In Touch
                        </h2>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white/0">
                                <!-- Heading: MODIFIED to text-xl and glass-text (white/light gray) -->
                                <h3 class="text-xl glass-text mb-4 border-l-4 border-orange-500 pl-3">
                                    Corporate & Manufacturing Address
                                </h3>
                                <p class="text-lg font-medium" style="color: var(--color-primary)">
                                    Suneel HI-TECH
                                </p>
                                <p class="text-secondary">
                                    Factory: GAT No. 126, Ganeshnagar Talawade,
                                </p>
                                <p class="text-secondary">
                                    Taluka Haveli, Pune - 412114, Maharashtra, India.
                                </p>

                                <!-- Heading: MODIFIED to text-xl and glass-text (white/light gray) -->
                                <h3 class="text-xl glass-text mt-6 mb-3 border-l-4 border-orange-500 pl-3">
                                    Contact Details
                                </h3>
                                <div class="space-y-3 text-secondary">
                                    <p class="flex items-center">
                                        <svg class="w-5 h-5 mr-3 saffron-text" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                                            </path>
                                        </svg>
                                        <span class="font-medium" style="color: var(--color-primary)">Phone:</span>
                                        <a href="tel:+919766001047" class="ml-2 hover:underline">9766001047</a>
                                        /
                                        <a href="tel:+918080106687" class="hover:underline">8080106687</a>
                                    </p>
                                    <p class="flex items-center">
                                        <svg class="w-5 h-5 mr-3 saffron-text" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 4v7a2 2 0 01-2 2H5a2 2 0 01-2-2v-7">
                                            </path>
                                        </svg>
                                        <span class="font-medium" style="color: var(--color-primary)">Email:</span>
                                        <a href="mailto:info@suneelhitech.com"
                                            class="ml-2 hover:underline">info@suneelhitech.com</a>
                                    </p>
                                    <p class="flex items-center">
                                        <svg class="w-5 h-5 mr-3 saffron-text" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                                            </path>
                                        </svg>
                                        <span class="font-medium" style="color: var(--color-primary)">Website:</span>
                                        <a href="https://www.suneelhitech.com" class="ml-2 hover:underline"
                                            target="_blank">www.suneelhitech.com</a>
                                    </p>
                                </div>
                            </div>

                            <!-- Map Placeholder -->
                            <div
                                class="h-64 md:h-full bg-gray-200/10 rounded-xl flex items-center justify-center border-2 border-orange-300">
                                <span class="text-secondary font-medium p-4 text-center">Map Location Placeholder for
                                    Pune Factory</span>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Mobile Bottom Navigation Bar (Fixed Bottom) -->
        <nav id="bottom-nav"
            class="flex md:hidden justify-around items-center h-14 border-t shadow-2xl z-20 translucent-card-dark"
            style="border-color: var(--border-color);">
            <!-- Home Button -->
            <button data-page="home" class="nav-btn text-sm active-link">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-xs"><strong>Home</strong></span>
            </button>
            <!-- About Button -->
            <button data-page="about" class="nav-btn text-sm">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-xs"><strong>About</strong></span>
            </button>
            <!-- Products Button -->
            <button data-page="products" class="nav-btn text-sm">
                <i data-lucide="home" class="w-6 h-6"></i>
                <!-- TEMPORARILY USING HOME ICON -->
                <span class="text-xs"><strong>Products</strong></span>
            </button>
            <!-- Contact Button -->
            <button data-page="contact" class="nav-btn text-sm">
                <i data-lucide="mail" class="w-6 h-6"></i>
                <span class="text-xs"><strong>Contact</strong></span>
            </button>
        </nav>
    </div>

    <script>
        // --- CONFIGURATION VARIABLES ---
        const SHOW_THEME_TOGGLE = false; // Set to 'false' to hide the button
        const DEFAULT_THEME = "light"; // Set the preferred initial theme

        // --- CAROUSEL CONFIGURATION ---
        const CARD_WIDTH_PERCENTAGE = 85; // Card width as a percentage of the container (85% recommended for mobile view)
        const CAROUSEL_AUTOSCROLL_DELAY = 5000; // 5 seconds for main product carousel
        // These constants are now unused as Billboards are CSS-driven.
        const CARD_WIDTH_CLIENT_CERT = 400;
        const CAROUSEL_AUTOSCROLL_DELAY_CLIENT_CERT = 1000;

        // CLIENT BILLBOARD CONFIG
        // FIX: Update ITEM_WIDTH to reflect 180px card + 24px margin = 204px
        const CLIENT_BILLBOARD_ITEM_WIDTH = 204;
        const CLIENT_BILLBOARD_SCROLL_DURATION_SECONDS = 30;

        // CERTIFICATION BILLBOARD CONFIG
        // FIX: Update ITEM_WIDTH to reflect 180px card + 24px margin = 204px
        const CERT_BILLBOARD_ITEM_WIDTH = 204;
        const CERT_BILLBOARD_SCROLL_DURATION_SECONDS = 20;


        // --- STROBE BACKGROUND CONFIGURATION ---
        const INDIAN_FLAG_COLORS = {
            SAFFRON: "255, 153, 51",
            WHITE: "255, 255, 255",
            GREEN: "19, 136, 8",
            ASHOKA_BLUE: "0, 0, 128",
        };

        const THEMES = {
            dark: {
                BASE_BACKGROUND_COLOR: "#1a1a1a",
                STROBE_COLORS_RGB: [
                    INDIAN_FLAG_COLORS.SAFFRON,
                    INDIAN_FLAG_COLORS.WHITE,
                    INDIAN_FLAG_COLORS.GREEN,
                    INDIAN_FLAG_COLORS.ASHOKA_BLUE,
                ],
                BOUNDARY_STROBE_COLOR_RGB: INDIAN_FLAG_COLORS.ASHOKA_BLUE,
                name: "dark",
            },
            light: {
                BASE_BACKGROUND_COLOR: "#e5e7eb",
                STROBE_COLORS_RGB: [
                    INDIAN_FLAG_COLORS.SAFFRON,
                    INDIAN_FLAG_COLORS.WHITE,
                    INDIAN_FLAG_COLORS.GREEN,
                    INDIAN_FLAG_COLORS.ASHOKA_BLUE,
                ],
                BOUNDARY_STROBE_COLOR_RGB: INDIAN_FLAG_COLORS.ASHOKA_BLUE,
                name: "light",
            },
        };

        const STROBE_CONFIG = {
            STROBE_TRAVEL_TIME_SECONDS: 5,
            BOUNDARY_STROBE_MULTIPLIER: 1.8,
            MAX_PATH_LENGTH: 35,
            TURN_INTERVAL: 500,
            STROBE_MAX_LIFE: 6000,
            AUTO_SPAWN_DELAY: 10000,
            STROBE_SPAWN_COUNT: 4,
            STROBE_OFFSET_DISTANCE: 12,
            MAIN_STROBE_HEAD_RADIUS: 2.5,
            MAIN_STROBE_TRAIL_WIDTH: 1.5,
            BOUNDARY_STROBE_PATH: 18,
            BOUNDARY_STROBE_HEAD_RADIUS: 3.0,
            BOUNDARY_STROBE_TRAIL_WIDTH: 2.0,
            HOLE_LIFE: 1500,
            SPARK_COUNT: 8,
            SPARK_LIFE: 0.2,
            SPARK_BASE_VELOCITY: 250,
            SPARK_GRAVITY: 900,
            SPARK_RADIUS: 1.5,
            SPARK_COLOR_RGB: "51, 255, 51",
            SPARK_TRIGGERS: {
                RESET_SPAWN: true,
                MAIN_COLLISION_BORDERS: true,
                MAIN_COLLISION_CARDS: true,
                MAIN_DIRECTION_CHANGES: false,
                BOUNDARY_STROBE_CORNER_HIT: true,
            },
        };

        // --- OTHER CONSTANTS & STATE ---
        const MAX_TILT = 3;
        const MAX_LIFT_Z = 20;
        const MAX_LIFT_Y = 2;
        const PARENT_HOVER_DELAY = 1000;
        const TILT_POWER = 2.5;

        let activeTheme = "dark";
        let BASE_BACKGROUND_COLOR = THEMES.dark.BASE_BACKGROUND_COLOR;
        let BASE_VELOCITY_PX_PER_S = 0;
        let lastTime = 0;

        let mainCarouselController = null;
        let carouselsInitialized = false;

        // list of variables for image paths
        const IMAGE_PATHS = {
            CLIENT_LOGOS: "assets/clients/",
            CERTIFICATES: "assets/certifications/",
            PRODUCTS: "assets/products/",
        };

        // image paths for various assets
        const IMAGE_FILES = {
            CLIENT_LOGOS: {
                IR: "1.png",
                NTPC: "2.png",
                MG: "3.png",
                PM: "4.png",
                SIEMENS: "5.png",
                ALSTOM: "6.png",
                CG: "7.png",
            },
            CERTIFICATES: {
                ISO_9001: "c1.png",
                MSME: "c2.png",
                NSIC: "c3.png",
                IEC: "c4.png",
                COS: "c5.png",
            },
            PRODUCTS: {
                // Electro-Mechanical Products
                EM_CONTACT_GROUP: "em1.png",
                EM_HEEL_PIECE: "em2.png",
                EM_QN1_RELAY: "em3.png",
                EM_QNA1_RELAY: "em4.png",
                EM_PUNCHING: "em5.png",
                EM_SUPPORT_HANDLE: "em6.png",
                EM_SLUG_SHUNT: "em7.png",
                EM_FASTENERS: "em8.png",
                // Polymer Products
                POLY_PC_COVER: "p1.png",
                POLY_FUSE_BLOCK: "p2.png",
                POLY_PLUG_BOARD: "p3.png",
                POLY_RAIL_JOINT: "p4.png",
                POLY_POINT_PLATE: "p5.png",
                POLY_BUSHINGS: "p6.png",
                POLY_FRP_BOX: "p7.png",
                POLY_CABLE_MARKER: "p8.png",
            },
        };

        // --- DATA DEFINITION FOR ALL CAROUSELS ---
        const CLIENT_DATA = [
            {
                name: "INDIAN R",
                image: IMAGE_FILES.CLIENT_LOGOS.IR,
                label: "INDIAN R",
                alt: "INDIAN R"
            },
            {
                name: "NTPC",
                image: IMAGE_FILES.CLIENT_LOGOS.NTPC,
                label: "NTPC",
                alt: "NTPC"
            },
            {
                name: "MAHAGENCO",
                image: IMAGE_FILES.CLIENT_LOGOS.MG,
                label: "MAHAGENCO",
                alt: "MAHAGENCO"
            },
            {
                name: "PUNE METRO",
                image: IMAGE_FILES.CLIENT_LOGOS.PM,
                label: "PUNE METRO",
                alt: "PUNE METRO"
            },
            {
                name: "SIEMENS",
                image: IMAGE_FILES.CLIENT_LOGOS.SIEMENS,
                label: "SIEMENS",
                alt: "SIEMENS"
            },
            {
                name: "ALSTOM",
                image: IMAGE_FILES.CLIENT_LOGOS.ALSTOM,
                label: "ALSTOM",
                alt: "ALSTOM"
            },
            {
                name: "Crompton Greaves",
                image: IMAGE_FILES.CLIENT_LOGOS.CG,
                label: "Crompton Greaves",
                alt: "Crompton Greaves"
            },
        ];

        const CLIENT_BILLBOARD_TOTAL_WIDTH = CLIENT_DATA.length * CLIENT_BILLBOARD_ITEM_WIDTH;
        // Set CSS variable for the animation target
        document.documentElement.style.setProperty('--billboard-total-width-negative', `-${CLIENT_BILLBOARD_TOTAL_WIDTH}px`);
        document.documentElement.style.setProperty('--billboard-scroll-duration', `${CLIENT_BILLBOARD_SCROLL_DURATION_SECONDS}s`);


        const CERT_DATA = [
            {
                name: "ISO 9001:2015",
                image: IMAGE_FILES.CERTIFICATES.ISO_9001,
                label: "ISO 9001:2015",
                alt: "ISO 9001:2015 Certification"
            },
            {
                name: "MSME",
                image: IMAGE_FILES.CERTIFICATES.MSME,
                label: "MSME",
                alt: "MSME Certificate"
            },
            {
                name: "NSIC",
                image: IMAGE_FILES.CERTIFICATES.NSIC,
                label: "NSIC",
                alt: "NSIC Registration"
            },
            {
                name: "IEC",
                image: IMAGE_FILES.CERTIFICATES.IEC,
                label: "IEC",
                alt: "IEC Compliance"
            },
            {
                name: "COS Approval",
                image: IMAGE_FILES.CERTIFICATES.COS,
                label: "COS Approval",
                alt: "Controller of Stores Approval"
            },
        ];

        const CERT_BILLBOARD_TOTAL_WIDTH = CERT_DATA.length * CERT_BILLBOARD_ITEM_WIDTH;
        document.documentElement.style.setProperty('--cert-billboard-total-width-negative', `-${CERT_BILLBOARD_TOTAL_WIDTH}px`);
        document.documentElement.style.setProperty('--cert-scroll-duration', `${CERT_BILLBOARD_SCROLL_DURATION_SECONDS}s`);


        const PRODUCT_CATEGORIES = {
            em: {
                title: "Electro-Mechanical Components",
                subtitle:
                    "Q Series Railway Signalling Relays Spare parts and other essential metal components.",
                icon: "‚öôÔ∏è",
                iconColor: "text-red-500",
                list: [
                    "Contact Group Assembly",
                    "Heel Piece, Armature & Core",
                    "Magnetic Path Assembly (QN1)",
                    "Magnetic Path Assembly (QNA-1)",
                    "Punching Items",
                    "Support Handle",
                    "Slug & Shunt",
                    "Fastener Set",
                ],
                materials:
                    "Materials: Brass, Copper, Phosphorus Bronze, Non-Magnetic Stainless Steel, and Magnetic Soft Iron.",
                products: [
                    {
                        name: "Contact Group Assembly",
                        summary: "For Q-Series Railway Signalling Relays.",
                        image: IMAGE_FILES.PRODUCTS.EM_CONTACT_GROUP,
                    },
                    {
                        name: "Heel Piece, Armature & Core",
                        summary: "Precision magnetic soft iron components.",
                        image: IMAGE_FILES.PRODUCTS.EM_HEEL_PIECE,
                    },
                    {
                        name: "Magnetic Path (QN1)",
                        summary: "Assembly for QN1 Type Relays.",
                        image: IMAGE_FILES.PRODUCTS.EM_QN1_RELAY,
                    },
                    {
                        name: "Magnetic Path (QNA-1)",
                        summary: "Assembly for QNA-1 Type Relays.",
                        image: IMAGE_FILES.PRODUCTS.EM_QNA1_RELAY,
                    },
                    {
                        name: "Punching Items",
                        summary: "Various stamped metal components.",
                        image: IMAGE_FILES.PRODUCTS.EM_PUNCHING,
                    },
                    {
                        name: "Support Handle",
                        summary: "Durable handles for equipment mounting.",
                        image: IMAGE_FILES.PRODUCTS.EM_SUPPORT_HANDLE,
                    },
                    {
                        name: "Slug & Shunt",
                        summary: "Critical components for relay timing.",
                        image: IMAGE_FILES.PRODUCTS.EM_SLUG_SHUNT,
                    },
                    {
                        name: "Fastener Set",
                        summary: "Complete set of high-tensile fasteners.",
                        image: IMAGE_FILES.PRODUCTS.EM_FASTENERS,
                    },
                ],
            },
            poly: {
                title: "Polymer Moulding Components",
                subtitle:
                    "Precision plastic components for various industrial applications and railways.",
                icon: "üî©",
                iconColor: "text-blue-500",
                list: [
                    "Polycarbonate Cover & Phenolic Base",
                    "PBT Fuse Blocks & Terminals",
                    "Phenolic Plug Board",
                    "TPU/Nylon Rail Joint Insulations",
                    "Point Insulation Plate",
                    "Insulation Bush Washers",
                    "FRP Track Lead Junction Box",
                    "FRP Cable Route Marker",
                ],
                materials:
                    "Materials: Nylon, PBT, PC, TPU, Phenolic Moulding Powder, and Composites.",
                products: [
                    {
                        name: "Polycarbonate Cover",
                        summary: "Transparent covers with Phenolic bases.",
                        image: IMAGE_FILES.PRODUCTS.POLY_PC_COVER,
                    },
                    {
                        name: "PBT Fuse Blocks",
                        summary: "High-resistance PBT blocks and terminals.",
                        image: IMAGE_FILES.PRODUCTS.POLY_FUSE_BLOCK,
                    },
                    {
                        name: "Phenolic Plug Board",
                        summary: "High dielectric strength plug boards.",
                        image: IMAGE_FILES.PRODUCTS.POLY_PLUG_BOARD,
                    },
                    {
                        name: "Rail Joint Insulations",
                        summary: "Made from durable TPU and Nylon materials.",
                        image: IMAGE_FILES.PRODUCTS.POLY_RAIL_JOINT,
                    },
                    {
                        name: "Point Insulation Plate",
                        summary: "TPU/Nylon plates for rail points.",
                        image: IMAGE_FILES.PRODUCTS.POLY_POINT_PLATE,
                    },
                    {
                        name: "Insulation Bush Washers",
                        summary: "TPU/Nylon washers for electrical insulation.",
                        image: IMAGE_FILES.PRODUCTS.POLY_BUSHINGS,
                    },
                    {
                        name: "FRP Junction Box",
                        summary: "Weather-proof Fibre Reinforced Plastic boxes.",
                        image: IMAGE_FILES.PRODUCTS.POLY_FRP_BOX,
                    },
                    {
                        name: "FRP Cable Marker",
                        summary: "Durable route markers for underground cables.",
                        image: IMAGE_FILES.PRODUCTS.POLY_CABLE_MARKER,
                    },
                ],
            },
        };

        // --- Utility: Convert Hex color to RGB array ---
        function hexToRgb(hex) {
            const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(
                shorthandRegex,
                (m, r, g, b) => r + r + g + g + b + b
            );

            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result
                ? [
                    parseInt(result[1], 16),
                    parseInt(result[2], 16),
                    parseInt(result[3], 16),
                ]
                : [0, 0, 0];
        }

        // --- Theme Switching Logic ---
        function setTheme(themeName, initialLoad = false) {
            const body = document.body;
            const themeIcon = document.getElementById("theme-icon");
            const themeToggle = document.getElementById("theme-toggle"); // Get the button element
            const themeConfig = THEMES[themeName];

            if (!themeConfig) return;

            activeTheme = themeName;

            // 1. Update DOM class for CSS variables
            if (themeName === "light") {
                body.classList.add("light-theme");
                // Icon to switch TO dark mode
                themeIcon.setAttribute("data-lucide", "moon");
                themeIcon.setAttribute("name", "moon");
            } else {
                body.classList.remove("light-theme");
                // Icon to switch TO light mode
                themeIcon.setAttribute("data-lucide", "sun");
                themeIcon.setAttribute("name", "sun");
            }

            // 2. FIX: Ensure the theme icon is rendered correctly immediately after setting the attribute
            // We use the globally exposed lucide object created in the module script below.
            if (window.lucide && window.lucide.createIcons) {
                const { Sun, Moon } = window.lucide;
                window.lucide.createIcons({ icons: { Sun, Moon } });
            }

            // 3. Conditional visibility based on the global constant
            if (themeToggle) {
                themeToggle.style.display = SHOW_THEME_TOGGLE ? "flex" : "none"; // Use flex/none for container
            }

            // 4. Update Canvas Variables
            BASE_BACKGROUND_COLOR = themeConfig.BASE_BACKGROUND_COLOR;
            Object.assign(STROBE_CONFIG, {
                STROBE_COLORS_RGB: themeConfig.STROBE_COLORS_RGB,
                BOUNDARY_STROBE_COLOR_RGB: themeConfig.BOUNDARY_STROBE_COLOR_RGB,
            });

            // 5. Persist state
            try {
                localStorage.setItem("theme", themeName);
            } catch (e) {
                console.error("Local storage error:", e);
            }

            // 6. Trigger Strobe Reset only on manual switch (not initial load)
            if (!initialLoad) {
                const [r, g, b] = hexToRgb(themeConfig.BASE_BACKGROUND_COLOR);
                ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Use the random launch for a manual theme switch
                const randomX = Math.random() * canvas.width;
                const randomY = Math.random() * canvas.height;
                initStrobes(randomX, randomY);
            }
        }

        // --- Card Interactive Hover Effects (Tilt and Lift) ---
        function setupCardHoverEffects() {
            // Define the selectors for large, parent elements that should NOT tilt
            const EXCLUDED_SELECTORS = [
                ".translucent-card-dark.p-8", // Slogan card on Home
                ".about-panel", // Main container on About Us
                ".home-panel", // Main container on Home
                ".contact-panel", // Main container on Contact
                ".billboard-item" // NEW: Exclude billboard items
            ].join(", ");

            // Select all interactive cards
            const allCards = document.querySelectorAll(".interactive-card");

            // Filter to get only the cards that should have the tilt effect
            const cards = Array.from(allCards).filter(card => !card.matches(EXCLUDED_SELECTORS));


            // Helper function to apply the tilt effect, keeping the code DRY.
            const applyTilt = (e, card) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const xCenter = x / rect.width - 0.5;
                const yCenter = y / rect.height - 0.5;

                const signY = Math.sign(xCenter);
                const normalizedDistanceY = Math.abs(xCenter) * 2;
                const scaledDistanceY = Math.pow(normalizedDistanceY, TILT_POWER);
                const rotateY = scaledDistanceY * MAX_TILT * signY;

                const signX = Math.sign(yCenter);
                const normalizedDistanceX = Math.abs(yCenter) * 2;
                const scaledDistanceX = Math.pow(normalizedDistanceX, TILT_POWER);
                const rotateX = scaledDistanceX * MAX_TILT * -signX;

                const liftZ = MAX_LIFT_Z;

                card.style.transform = `perspective(1000px) 
                                        rotateX(${rotateX}deg) 
                                        rotateY(${rotateY}deg) 
                                        translateZ(${liftZ}px) 
                                        translateY(-${MAX_LIFT_Y}px)`; // Uses reduced MAX_LIFT_Y
            };

            cards.forEach((card) => {
                // Each card gets its own timer and state flag.
                let parentHoverTimeout = null;
                let justLeftChild = false;

                card.addEventListener("mousemove", (e) => {
                    const closestCard = e.target.closest(".interactive-card");

                    if (closestCard !== card) {
                        // Mouse is over a child card.
                        card.style.transform =
                            "perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0) translateY(0)";
                        clearTimeout(parentHoverTimeout);
                        parentHoverTimeout = null;
                        justLeftChild = true;
                        return;
                    }

                    if (justLeftChild) {
                        if (!parentHoverTimeout) {
                            parentHoverTimeout = setTimeout(() => {
                                applyTilt(e, card);
                                parentHoverTimeout = null;
                            }, PARENT_HOVER_DELAY);
                        }
                    } else {
                        applyTilt(e, card);
                    }
                });

                card.addEventListener("mouseleave", () => {
                    card.style.transform =
                        "perspective(1000px) rotateX(0deg) rotateY(0deg) translateZ(0) translateY(0)";
                    clearTimeout(parentHoverTimeout);
                    parentHoverTimeout = null;
                    justLeftChild = false;
                });

                card.addEventListener("mouseenter", (e) => {
                    const closestCard = e.target.closest(".interactive-card");
                    if (closestCard === card) {
                        justLeftChild = false;
                    }
                });
            });
        }


        // --- CAROUSEL LOGIC (UNIFIED) ---
        function createIndexedCarousel(config) {
            const carouselContainer = document.getElementById(config.containerId);
            const track = document.getElementById(config.trackId);
            const tabsContainer = document.getElementById(config.tabsContainerId);

            // Elements only used by the DYNAMIC Product Carousel
            const loader = config.loaderId ? document.getElementById(config.loaderId) : null;
            const loadingBarFill = config.loadingBarId ? document.getElementById(config.loadingBarId).querySelector(".loading-bar-fill") : null;
            const pauseIndicator = config.pauseIndicatorId ? document.getElementById(config.pauseIndicatorId) : null;

            if (!track || !tabsContainer || !carouselContainer) return;

            let currentIndex = 0;
            let currentCategory = config.initialCategory || 'default';
            let autoScrollInterval = null;
            let isPaused = false;
            let isProgrammaticScroll = false; // <<< NEW FLAG for bug fix
            let currentData = config.data;
            const CARD_WIDTH_STYLE = `${CARD_WIDTH_PERCENTAGE}%`;


            // --- Timer Management ---
            function stopAutoScroll() {
                if (autoScrollInterval) {
                    clearInterval(autoScrollInterval);
                    autoScrollInterval = null;
                    if (config.isProductCarousel && loadingBarFill) loadingBarFill.style.animationPlayState = "paused";
                }
            }

            function startAutoScroll() {
                if (isPaused || autoScrollInterval) return;

                if (config.isProductCarousel) {
                    // Complex loading bar and pause indicator animation for product carousel
                    if (loadingBarFill) {
                        loadingBarFill.style.animation = "none";
                        void loadingBarFill.offsetWidth;
                        loadingBarFill.style.animation = `fill-bar ${config.scrollDuration / 1000
                            }s linear forwards`;
                        loadingBarFill.style.animationPlayState = "running";
                    }
                }

                // Set the interval to call updateCarousel
                autoScrollInterval = setInterval(() => {
                    updateCarousel(currentIndex + 1);
                }, config.scrollDuration);
            }

            function resetAutoScroll() {
                stopAutoScroll();
                startAutoScroll();
            }

            // --- Pause/Resume Logic ---
            function pauseCarousel(manual = true) {
                if (manual) {
                    isPaused = true;
                    if (config.isProductCarousel) {
                        if (loadingBarFill) loadingBarFill.parentElement.style.opacity = 0;
                        if (pauseIndicator) pauseIndicator.classList.add("show");
                    }
                }
                stopAutoScroll();
            }

            function resumeCarousel(manual = true) {
                if (manual) {
                    isPaused = false;
                    if (config.isProductCarousel) {
                        if (loadingBarFill) loadingBarFill.parentElement.style.opacity = 1;
                        if (pauseIndicator) pauseIndicator.classList.remove("show");
                    }
                }
                startAutoScroll();
            }

            // --- Content & UI Rendering ---
            function renderContent(categoryKey, withTransition = true) {
                currentCategory = categoryKey;

                // 1. Determine data source
                if (config.isProductCarousel) {
                    const categoryData = config.productCategories[categoryKey];
                    currentData = categoryData.products;

                    // Update static product category details
                    if (config.categoryTitle) document.getElementById(config.categoryTitle).textContent = categoryData.title;
                    if (config.categorySubtitle) document.getElementById(config.categorySubtitle).textContent = categoryData.subtitle;
                    if (config.categoryIcon) {
                        const iconEl = document.getElementById(config.categoryIcon);
                        iconEl.textContent = categoryData.icon;
                        iconEl.className = `mr-2 ${categoryData.iconColor}`;
                    }
                    if (config.categoryList) {
                        const listEl = document.getElementById(config.categoryList);
                        listEl.innerHTML = "";
                        // RESTORED: Now repopulating the list for the Product page below the carousel
                        categoryData.list.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            listEl.appendChild(li);
                        });
                    }
                    if (config.categoryMaterials) document.getElementById(config.categoryMaterials).textContent = categoryData.materials;

                    // Apply responsive card width for main carousel
                    document.documentElement.style.setProperty('--card-width', CARD_WIDTH_STYLE);

                } else {
                    // This logic branch is no longer reached by any active carousel
                    currentData = config.data;
                    // Apply static width 
                    document.documentElement.style.setProperty('--card-width', `${CARD_WIDTH_CLIENT_CERT}px`);
                }

                // 2. Show Loader and Pause (only for main product carousel)
                if (loader) loader.classList.add("show");
                pauseCarousel(false);

                // Clear and re-render the content
                track.innerHTML = "";
                tabsContainer.innerHTML = "";
                currentIndex = 0;

                // 3. Render Carousel Cards and Tabs
                currentData.forEach((item, index) => {
                    // Create Tab
                    const tab = document.createElement("button");
                    tab.className = "product-sub-tab";
                    tab.textContent = item.name;
                    tab.dataset.index = index;
                    tabsContainer.appendChild(tab);

                    // Create Card
                    let card = document.createElement("div");
                    card.className = "carousel-card translucent-card-light rounded-lg";

                    // Set unique attributes
                    card.dataset.index = index;
                    card.id = `${config.containerId}-card-${index}`;

                    // Set up local image path and robust fallback 

                    const localImagePath = IMAGE_PATHS.PRODUCTS + `/${item.image}`;
                    const fallbackUrl = `https://placehold.co/400x350/111827/FF9933?text=${item.name}`;

                    // Determine content based on carousel type
                    let innerHTML;
                    if (config.isProductCarousel) {
                        // DYNAMIC PRODUCT VIEW: All cards are rendered for scrolling
                        innerHTML = `
                            <div class="carousel-card-inner">
                                <div class="card-image-section rounded-l-lg">
                                    <img src="${localImagePath}" alt="${item.name}" 
                                         onerror="this.onerror=null; this.src='${fallbackUrl}';">
                                    <div class="card-title-overlay">
                                        <h4 class="text-xl font-bold glass-text">${item.name}</h4>
                                    </div>
                                </div>
                                <div class="card-desc-section rounded-r-lg">
                                    <p class="text-sm text-secondary">${item.summary}</p>
                                    <p class="text-xs text-secondary mt-4 italic">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                        `;
                    } else {
                        // This path is no longer reached by any active carousel
                        innerHTML = `
                            <div class="carousel-card-inner">
                                <div class="card-image-section rounded-lg">
                                    <img src="${localImagePath}" alt="${item.alt}"
                                         onerror="this.onerror=null; this.src='${fallbackUrl}';">
                                    <div class="card-title-overlay">
                                        <h4 class="text-xl font-bold glass-text">${item.label}</h4>
                                    </div>
                                </div>
                            </div>
                        `;
                    }

                    card.innerHTML = innerHTML;
                    track.appendChild(card);
                });

                // 4. Finalize UI
                tabsContainer.querySelectorAll(".product-sub-tab").forEach((tab, index) => {
                    tab.classList.toggle("active", index === 0);
                });

                setTimeout(() => {
                    if (loader) loader.classList.remove("show");
                    updateCarousel(0, withTransition);
                    resumeCarousel(false); // Start the timer after initial rendering
                }, 100);
            }

            // --- Core Carousel Movement (Used by ALL carousels now) ---
            function updateCarousel(newIndex, withTransition = true) {
                const products = currentData;
                if (products.length === 0) return;

                // Handle circular scroll logic for next/prev
                let nextIndex = newIndex;
                if (nextIndex < 0) {
                    nextIndex = products.length - 1;
                } else if (nextIndex >= products.length) {
                    nextIndex = 0;
                }

                const targetCard = document.getElementById(`${config.containerId}-card-${nextIndex}`);
                if (!targetCard) return;

                currentIndex = nextIndex;

                // Use scrollIntoView to center the card.
                const scrollOptions = {
                    behavior: withTransition ? 'smooth' : 'instant',
                    inline: 'center',
                    // FIX: Prevent page scroll by explicitly setting block to 'nearest' or 'center'.
                    block: 'nearest'
                };

                isProgrammaticScroll = true; // <<< Set flag BEFORE the scroll starts
                targetCard.scrollIntoView(scrollOptions);


                // Update active tab state immediately
                tabsContainer.querySelectorAll(".product-sub-tab").forEach((tab) => {
                    const tabIndex = parseInt(tab.dataset.index);
                    tab.classList.toggle("active", tabIndex === currentIndex);
                });

                // Reset auto-scroll for every movement (for all carousels)
                resetAutoScroll();

                // Force active card visual state
                track.querySelectorAll(".carousel-card").forEach((card) => {
                    const cardIndex = parseInt(card.dataset.index);
                    card.classList.toggle("active", cardIndex === currentIndex);
                });
            }

            // --- Event Listeners ---
            let scrollTimeout;
            carouselContainer.addEventListener('scroll', () => {
                // Determine current index based on scroll position
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    const cards = track.querySelectorAll(".carousel-card");
                    let closestCardIndex = 0;
                    let minDistance = Infinity;

                    cards.forEach((card, i) => {
                        const rect = card.getBoundingClientRect();
                        const distance = Math.abs(
                            rect.left + rect.width / 2 - carouselContainer.offsetWidth / 2
                        );

                        if (distance < minDistance) {
                            minDistance = distance;
                            closestCardIndex = parseInt(card.dataset.index);
                        }
                    });

                    if (closestCardIndex !== currentIndex) {
                        currentIndex = closestCardIndex;
                        updateCarousel(currentIndex, false);
                    }
                }, 150);

                // Pause timer while user is actively scrolling AND it is NOT a programmatic scroll
                if (!isPaused && !isProgrammaticScroll) { // <<< FIX: Check new flag
                    pauseCarousel(false);
                }
            });

            // Resume timer after programmatic scroll finishes (guaranteed to fire on scroll)
            carouselContainer.addEventListener('scrollend', () => {
                isProgrammaticScroll = false; // <<< Reset flag
                // Only resume if it wasn't paused manually by the user
                if (!isPaused) {
                    resumeCarousel(false);
                }
            });

            // Resume timer after user finishes manual scrolling/dragging
            // Note: mouseup/touchend are kept for fallback on browsers not fully supporting scrollend
            carouselContainer.addEventListener('touchend', () => {
                isProgrammaticScroll = false; // Reset flag on touch end
                resumeCarousel(false);
            });
            carouselContainer.addEventListener('mouseup', () => {
                setTimeout(() => {
                    isProgrammaticScroll = false; // Reset flag after scroll momentum might end
                    resumeCarousel(false);
                }, 500);
            });

            // Global pause/resume on hover/touch
            const pauseEvents = {
                start: ["mouseenter", "touchstart"],
                end: ["mouseleave", "touchend"],
            };

            pauseEvents.start.forEach((event) => {
                carouselContainer.addEventListener(event, () => pauseCarousel(true));
            });
            pauseEvents.end.forEach((event) => {
                if (event === 'mouseleave') {
                    carouselContainer.addEventListener(event, () => resumeCarousel(true));
                }
            });

            // Tab click listener
            tabsContainer.addEventListener("click", (e) => {
                if (e.target.matches(".product-sub-tab")) {
                    const index = parseInt(e.target.dataset.index);
                    updateCarousel(index);
                }
            });

            // Card click listener (centers the card)
            track.addEventListener("click", (e) => {
                const card = e.target.closest(".carousel-card");
                if (card) {
                    const index = parseInt(card.dataset.index);
                    updateCarousel(index, true);
                }
            });


            return {
                loadCategory: (categoryKey, withTransition = true) => renderContent(categoryKey, withTransition),
                update: (index, transition) => updateCarousel(index, transition),
                // Stop/Start control the auto-scroll timer
                stop: () => stopAutoScroll(),
                start: () => startAutoScroll(),
                isPaused: () => isPaused,
                getCurrentIndex: () => currentIndex,
            };
        }

        // --- CLIENT BILLBOARD SETUP (CSS DRIVEN) ---
        function setupClientBillboard() {
            const track = document.getElementById('client-billboard-track');
            if (!track) return;

            // 1. Create one set of cards
            const itemHTML = CLIENT_DATA.map(client => {
                // Local file path (assuming PNG format, all lowercase)
                const localImagePath = IMAGE_PATHS.CLIENT_LOGOS + `/${client.image}`;
                // Robust fallback placeholder URL
                const fallbackUrl = `https://placehold.co/80x80/1f2937/FF9933?text=${client.name}`;
                return `
                <div class="billboard-item">
                    <div class="billboard-item-content">
                        <img src="${localImagePath}" 
                             alt="${client.alt} Logo" 
                             class="billboard-image" 
                             onerror="this.onerror=null; this.src='${fallbackUrl}';" />
                        <span class="text-base font-bold">${client.label}</span>
                    </div>
                </div>
            `;
            }).join('');

            // 2. Duplicate content for infinite loop effect
            track.innerHTML = itemHTML + itemHTML;
        }

        // --- CERTIFICATION BILLBOARD SETUP (CSS DRIVEN) ---
        function setupCertBillboard() {
            const track = document.getElementById('cert-billboard-track');
            if (!track) return;

            // 1. Create one set of cards
            const itemHTML = CERT_DATA.map(cert => {
                // Local file path (assuming PNG format, all lowercase)
                const localImagePath = IMAGE_PATHS.CERTIFICATES + `/${cert.image}`;
                // Robust fallback placeholder URL
                const fallbackUrl = `https://placehold.co/80x80/1f2937/FF9933?text=${cert.name}`;

                return `
                <div class="billboard-item">
                    <div class="billboard-item-content">
                        <img src="${localImagePath}" 
                             alt="${cert.alt}" 
                             class="billboard-image" 
                             onerror="this.onerror=null; this.src='${fallbackUrl}';" />
                        <div class="flex flex-col text-center">
                            <span class="text-base font-bold leading-tight">${cert.name.split(':')[0]}</span>
                            <span class="text-xs text-secondary leading-tight">${cert.label.includes(':') ? cert.name.split(':')[1] || 'Certified' : 'Registered'}</span>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            // 2. Duplicate content for infinite loop effect
            track.innerHTML = itemHTML + itemHTML;
        }

        // --- GLOBAL INITIALIZATION FUNCTION ---
        function setupAllCarousels() {
            if (carouselsInitialized) return;

            // 1. Setup Client Billboard (Home Page) - CSS SCROLLING
            setupClientBillboard();

            // 2. Setup Certification Billboard (About Page) - CSS SCROLLING
            setupCertBillboard();


            // 3. Setup Main Product Carousel (Products Page) - DYNAMIC SCROLLING
            mainCarouselController = createIndexedCarousel({
                containerId: 'main-carousel-container',
                trackId: 'main-carousel-track',
                tabsContainerId: 'sub-tabs',
                productCategories: PRODUCT_CATEGORIES,
                loadingBarId: 'main-loading-bar',
                pauseIndicatorId: 'pause-indicator',
                loaderId: 'carousel-loader',
                categoryTitle: 'category-title',
                categorySubtitle: 'category-subtitle',
                categoryIcon: 'category-icon',
                categoryList: 'category-list',
                categoryMaterials: 'category-materials',
                scrollDuration: CAROUSEL_AUTOSCROLL_DELAY,
                initialCategory: 'em',
                isProductCarousel: true
            });


            // Re-render hourglass icon using Lucide's createIcons
            if (window.lucide && window.lucide.createIcons) {
                const { Hourglass } = window.lucide;
                window.lucide.createIcons({ icons: { Hourglass } });
            }

            carouselsInitialized = true;
        }


        // --- Initialization and Event Listeners (Kept separate from canvas) ---
        document.addEventListener("DOMContentLoaded", () => {
            const navButtons = document.querySelectorAll(".nav-btn");
            const pages = document.querySelectorAll(".page-content");
            const themeToggle = document.getElementById("theme-toggle");

            // --- THEME INITIALIZATION ---
            let storedTheme = DEFAULT_THEME;
            try {
                storedTheme = localStorage.getItem("theme") || DEFAULT_THEME;
            } catch (e) {
                storedTheme = DEFAULT_THEME;
            }
            setTheme(storedTheme, true);

            setupCardHoverEffects();
            setupAllCarousels(); // Initialize all three carousels immediately

            // --- Product Page Main Tab Logic (Still needed) ---
            const mainTabButtons = document.querySelectorAll(".main-tab-btn");

            mainTabButtons.forEach((button) => {
                button.addEventListener("click", (e) => {
                    const targetTab = button.dataset.tab;

                    // 1. Update button states
                    mainTabButtons.forEach((btn) => {
                        btn.classList.toggle("active", btn.dataset.tab === targetTab);
                    });

                    // 2. Change the content of the single central carousel
                    if (mainCarouselController) {
                        mainCarouselController.loadCategory(targetTab);
                    }
                });
            });

            // --- Navigation Logic (FIX 1: Desktop Nav Button Update Logic) ---
            function showPage(targetPageId, event = null, skipStrobeInit = false) {
                pages.forEach((page) => page.classList.add("hidden"));

                const targetPage = document.getElementById(`page-${targetPageId}`);
                if (targetPage) {
                    targetPage.classList.remove("hidden");

                    const mainScrollView = document.getElementById('main-scroll-view');
                    if (mainScrollView) {
                        mainScrollView.scrollTop = 0;
                    }

                    // START/STOP CAROUSELS based on page navigation
                    if (mainCarouselController) {
                        // Reloads initial category for Product view on page show
                        if (targetPageId === "products") mainCarouselController.loadCategory("em", false);
                        mainCarouselController.stop();
                        if (targetPageId === "products") mainCarouselController.start();
                        else mainCarouselController.stop();
                    }

                    // Billboard (CSS driven) requires no JS start/stop
                }

                if (!skipStrobeInit) {
                    let startX, startY;
                    if (event) {
                        const rect = event.currentTarget.getBoundingClientRect();
                        startX = rect.left + rect.width / 2;
                        startY = rect.top + rect.height / 2;
                    } else {
                        const { x: base_x, y: base_y } = getLogoStart();
                        startX = base_x;
                        startY = base_y;
                    }
                    initStrobes(startX, startY);
                }

                // FIX 1: Update active state for both Desktop and Mobile navigation buttons
                document.querySelectorAll(".nav-btn").forEach((btn) => {
                    const pageId = btn.getAttribute("data-page");
                    if (pageId === targetPageId) {
                        btn.classList.add("active-link");
                        // Mobile nav buttons use a different color class that needs removal
                        btn.classList.remove("text-secondary");
                    } else {
                        btn.classList.remove("active-link");
                        // Mobile nav buttons need the secondary color class
                        btn.classList.add("text-secondary");
                    }
                });
            }

            navButtons.forEach((button) => {
                button.addEventListener("click", (event) => {
                    const targetPageId = event.currentTarget.getAttribute("data-page");
                    if (targetPageId) {
                        showPage(targetPageId, event, false);
                    }
                });
            });

            document.addEventListener("click", (event) => {
                if (
                    !event.target.closest(".nav-btn") &&
                    !event.target.closest("header") &&
                    !event.target.closest(".interactive-card")
                ) {
                    initStrobes(event.clientX, event.clientY);
                }
            });

            // Only add the click listener if the button is configured to show
            if (SHOW_THEME_TOGGLE) {
                themeToggle.addEventListener("click", () => {
                    const newTheme = activeTheme === "dark" ? "light" : "dark";
                    setTheme(newTheme);
                });
            }

            // --- INITIAL PAGE LOAD SEQUENCE ---
            initCornerLaunch();
            showPage("home", null, true);
        });

        // --- Canvas Strobe Animation Logic (Tron/Snake Style) ---
        const canvas = document.getElementById("backgroundCanvas");
        const ctx = canvas.getContext("2d");
        let strobes = [];
        let boundaryStrobes = [];
        let holes = [];
        let sparks = [];

        let lastStrobeStarted = Date.now();
        let lastStrobeCleared = null;

        // --- HoleEffect Class (FIX 2: Ensure all classes are defined) ---
        class HoleEffect {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.startTime = Date.now();
                this.lifeDuration = STROBE_CONFIG.HOLE_LIFE;
            }
            draw() {
                const elapsed = Date.now() - this.startTime;
                const progress = elapsed / this.lifeDuration;

                if (progress >= 1) return true;

                const opacity = 1.0 - progress;
                const radius = 2 + progress * 5;
                const lineWidth = 1 + (1 - progress) * 1.5;

                ctx.save();
                ctx.beginPath();
                ctx.strokeStyle = `rgba(${this.color}, ${opacity})`;
                ctx.lineWidth = lineWidth;
                ctx.arc(this.x, this.y, radius, 0, Math.PI * 2);
                ctx.stroke();
                ctx.restore();

                return false;
            }
        }

        // --- Spark Class (FIX 2: Ensure all classes are defined) ---
        class Spark {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.startTime = Date.now();
                this.lifeDuration = STROBE_CONFIG.SPARK_LIFE * 1000; // Convert seconds to milliseconds

                // Velocities defined in pixels/second
                this.vy = Math.random() * STROBE_CONFIG.SPARK_BASE_VELOCITY + 50;
                this.vx =
                    (Math.random() - 0.5) * STROBE_CONFIG.SPARK_BASE_VELOCITY * 1.5;
            }

            draw(deltaTime) {
                const elapsed = Date.now() - this.startTime;
                const progress = elapsed / this.lifeDuration;

                if (progress >= 1) return true;

                // Update position based on frame-rate independent physics
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;

                // Apply gravity (acceleration * deltaTime)
                this.vy += STROBE_CONFIG.SPARK_GRAVITY * deltaTime;

                const opacity = 1.0 - progress;
                const radius = STROBE_CONFIG.SPARK_RADIUS * (1 - progress);

                ctx.save();

                // Apply intense glow only when the particle is very new for the "pop"
                if (progress < 0.2) {
                    ctx.shadowBlur = 8;
                    ctx.shadowColor = `rgba(${this.color}, 1)`;
                } else {
                    ctx.shadowBlur = 0;
                }

                ctx.fillStyle = `rgba(${this.color}, ${opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                return false;
            }
        }

        function spawnSparks(x, y, count = STROBE_CONFIG.SPARK_COUNT) {
            const color = STROBE_CONFIG.SPARK_COLOR_RGB;
            for (let i = 0; i < count; i++) {
                sparks.push(new Spark(x, y, color));
            }
        }

        function getPanelBounds() {
            const visiblePage = document.querySelector(
                ".page-content:not(.hidden)"
            );
            if (!visiblePage) return [];

            // FIX: Removed .carousel-card from the selector list since they are no longer in use as trace boundaries.
            const selectors = [
                ".home-panel",
                ".about-panel",
                ".contact-panel",
            ];
            let panels = [];

            visiblePage
                .querySelectorAll(selectors.join(", "))
                .forEach((element) => {
                    const rect = element.getBoundingClientRect();
                    if (rect.bottom > 0 && rect.top < canvas.height) {
                        panels.push({ rect, domElement: element });
                    }
                });
            return panels;
        }

        function isTracingActive(element) {
            return boundaryStrobes.some(
                (bs) => bs.domElement === element && !bs.isComplete
            );
        }

        function spawnBoundaryStrobe(rect, element, startX, startY, color) {
            const newStrobe = new BoundaryStrobe(
                rect,
                element,
                startX,
                startY,
                color
            );
            boundaryStrobes.push(newStrobe);
        }

        // --- BoundaryStrobe Class (FIX 2: Ensure all classes are defined) ---
        class BoundaryStrobe {
            constructor(rect, domElement, startX, startY, color) {
                this.rect = rect;
                this.domElement = domElement;
                this.color = color;
                // Speed is defined as a multiplier of BASE_VELOCITY_PX_PER_S
                this.speed =
                    BASE_VELOCITY_PX_PER_S * STROBE_CONFIG.BOUNDARY_STROBE_MULTIPLIER;
                this.maxPath = STROBE_CONFIG.BOUNDARY_STROBE_PATH;
                this.path = [];
                this.isComplete = false;

                this.corners = [
                    { x: rect.left, y: rect.top },
                    { x: rect.right, y: rect.top },
                    { x: rect.right, y: rect.bottom },
                    { x: rect.left, y: rect.bottom },
                ];

                this.x = startX;
                this.y = startY;
                this.segmentsCompleted = 0;

                let minDistance = Infinity;
                let startCornerIndex = 0;
                this.corners.forEach((corner, index) => {
                    const dist = Math.hypot(corner.x - startX, corner.y - startY);
                    if (dist < minDistance) {
                        minDistance = dist;
                        startCornerIndex = index;
                    }
                });

                this.currentCornerIndex = startCornerIndex;
            }

            update(deltaTime) {
                if (this.isComplete || !BASE_VELOCITY_PX_PER_S) return;

                const targetCorner = this.corners[this.currentCornerIndex];
                const movementStep = this.speed * deltaTime; // Dynamic step based on time and calculated speed

                let dx = targetCorner.x - this.x;
                let dy = targetCorner.y - this.y;
                const distance = Math.hypot(dx, dy);

                if (distance < movementStep) {
                    this.x = targetCorner.x;
                    this.y = targetCorner.y;
                    this.segmentsCompleted++;

                    if (STROBE_CONFIG.SPARK_TRIGGERS.BOUNDARY_STROBE_CORNER_HIT) {
                        spawnSparks(this.x, this.y);
                    }

                    this.currentCornerIndex = (this.currentCornerIndex + 1) % 4;

                    if (this.segmentsCompleted >= 4) {
                        this.isComplete = true;
                        return;
                    }
                } else {
                    const angle = Math.atan2(dy, dx);
                    this.x += Math.cos(angle) * movementStep;
                    this.y += Math.sin(angle) * movementStep;
                }

                this.path.push({ x: this.x, y: this.y });
                if (this.path.length > this.maxPath) {
                    this.path.shift();
                }
            }

            draw() {
                if (this.isComplete) return;

                ctx.beginPath();
                ctx.lineWidth = STROBE_CONFIG.MAIN_STROBE_TRAIL_WIDTH;
                ctx.lineJoin = "round";
                ctx.lineCap = "round";

                const baseColor = this.color;

                for (let i = 1; i < this.path.length; i++) {
                    const alpha = (i / this.path.length) * 0.6;
                    ctx.strokeStyle = `rgba(${baseColor}, ${alpha})`;
                    ctx.moveTo(this.path[i - 1].x, this.path[i - 1].y);
                    ctx.lineTo(this.path[i].x, this.path[i].y);
                }
                ctx.stroke();

                ctx.fillStyle = `rgba(${baseColor}, 1)`;
                ctx.shadowBlur = 10;
                ctx.shadowColor = `rgba(${baseColor}, 1)`;
                ctx.beginPath();
                ctx.arc(
                    this.x,
                    this.y,
                    STROBE_CONFIG.MAIN_STROBE_HEAD_RADIUS,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        // --- Main Strobe Class (FIX 2: Ensure all classes are defined) ---
        class Strobe {
            constructor(x, y, dx, dy, color) {
                this.x = x;
                this.y = y;
                // dx/dy are the direction unit vectors (-1, 0, or 1)
                this.dx = dx;
                this.dy = dy;
                this.color = color;
                this.path = [];
                this.maxPath = STROBE_CONFIG.MAX_PATH_LENGTH;
                this.startTime = Date.now();
                this.lastTurnTime = Date.now();
            }

            randomTurn() {
                const directions = [
                    [1, 0],
                    [-1, 0],
                    [0, 1],
                    [0, -1],
                    [1, 1],
                    [1, -1],
                    [-1, 1],
                    [-1, -1],
                ];
                // Prevent immediate U-turn (reversing direction)
                const validTurns = directions.filter(([ndx, ndy]) => {
                    return !(ndx === -this.dx && ndy === -this.dy);
                });

                const newDir =
                    validTurns[Math.floor(Math.random() * validTurns.length)];
                this.dx = newDir[0];
                this.dy = newDir[1];
            }

            update(deltaTime) {
                if (!BASE_VELOCITY_PX_PER_S) return;

                const now = Date.now();
                const movementStep = BASE_VELOCITY_PX_PER_S * deltaTime; // Dynamic movement step (px/s * s = px)

                // 1. Forced Direction Change Check
                if (now - this.lastTurnTime >= STROBE_CONFIG.TURN_INTERVAL) {
                    this.randomTurn();
                    this.lastTurnTime = now;

                    if (STROBE_CONFIG.SPARK_TRIGGERS.MAIN_DIRECTION_CHANGES) {
                        spawnSparks(this.x, this.y);
                    }
                }

                // 2. Panel Boundary Strobe Spawning (PASS-THROUGH LOGIC)
                const panels = getPanelBounds();
                const MARGIN = 1;

                panels.forEach(({ rect, domElement }) => {
                    const nextX = this.x + this.dx * movementStep;
                    const nextY = this.y + this.dy * movementStep;

                    let hit = false;
                    let hitX = this.x;
                    let hitY = this.y;

                    // Check if the strobe *will* cross any edge in the next step
                    if (this.y > rect.top - MARGIN && this.y < rect.bottom + MARGIN) {
                        if (this.dx > 0 && nextX >= rect.left && this.x < rect.left) {
                            hitX = rect.left;
                            hit = true;
                        } else if (
                            this.dx < 0 &&
                            nextX <= rect.right &&
                            this.x > rect.right
                        ) {
                            hitX = rect.right;
                            hit = true;
                        }
                    }

                    if (this.x > rect.left - MARGIN && this.x < rect.right + MARGIN) {
                        if (this.dy > 0 && nextY >= rect.top && this.y < rect.top) {
                            hitY = rect.top;
                            hit = true;
                        } else if (
                            this.dy < 0 &&
                            nextY <= rect.bottom &&
                            this.y > rect.bottom
                        ) {
                            hitY = rect.bottom;
                            hit = true;
                        }
                    }

                    if (hit) {
                        if (!isTracingActive(domElement)) {
                            // Spawn boundary strobe at the edge where collision occurred
                            spawnBoundaryStrobe(rect, domElement, hitX, hitY, this.color);
                        }
                        if (STROBE_CONFIG.SPARK_TRIGGERS.MAIN_COLLISION_CARDS) {
                            spawnSparks(hitX, hitY);
                        }
                        // Primary strobe continues to pass through
                    }
                });

                // 3. Update Position
                this.x += this.dx * movementStep;
                this.y += this.dy * movementStep;

                // 4. Window Boundary Collision Detection (Bouncing)
                let bounced = false;
                if (this.x <= 0 || this.x >= canvas.width) {
                    this.dx *= -1;
                    this.x = this.x <= 0 ? 0 : canvas.width;
                    bounced = true;
                }
                if (this.y <= 0 || this.y >= canvas.height) {
                    this.dy *= -1;
                    this.y = this.y <= 0 ? 0 : canvas.height;
                    bounced = true;
                }

                if (bounced && STROBE_CONFIG.SPARK_TRIGGERS.MAIN_COLLISION_BORDERS) {
                    spawnSparks(this.x, this.y);
                }

                // 5. Update Path/Tail
                this.path.push({ x: this.x, y: this.y });
                if (this.path.length > this.maxPath) {
                    this.path.shift();
                }
            }

            draw() {
                if (this.isComplete) return;

                ctx.beginPath();
                ctx.lineWidth = STROBE_CONFIG.MAIN_STROBE_TRAIL_WIDTH;
                ctx.lineJoin = "round";
                ctx.lineCap = "round";

                const baseColor = this.color;

                for (let i = 1; i < this.path.length; i++) {
                    const alpha = (i / this.path.length) * 0.6;
                    ctx.strokeStyle = `rgba(${baseColor}, ${alpha})`;
                    ctx.moveTo(this.path[i - 1].x, this.path[i - 1].y);
                    ctx.lineTo(this.path[i].x, this.path[i].y);
                }
                ctx.stroke();

                ctx.fillStyle = `rgba(${baseColor}, 1)`;
                ctx.shadowBlur = 10;
                ctx.shadowColor = `rgba(${baseColor}, 1)`;
                ctx.beginPath();
                ctx.arc(
                    this.x,
                    this.y,
                    STROBE_CONFIG.MAIN_STROBE_HEAD_RADIUS,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }


        function getLogoStart() {
            const LOGO_OFFSET_X = 20;
            const logoElement = document.querySelector("header");
            if (!logoElement) return { x: 20, y: 20 };

            const rect = logoElement.getBoundingClientRect();
            const startX = rect.left + LOGO_OFFSET_X;
            const startY_Base = rect.top + rect.height / 2;

            return { x: startX, y: startY_Base };
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // --- DYNAMIC SPEED CALCULATION ---
            // Calculate the required speed in pixels per second to cross max dimension in STROBE_TRAVEL_TIME_SECONDS
            const maxDimension = Math.max(canvas.width, canvas.height);
            BASE_VELOCITY_PX_PER_S =
                maxDimension / STROBE_CONFIG.STROBE_TRAVEL_TIME_SECONDS;

            // Full clear on resize
            const [r, g, b] = hexToRgb(BASE_BACKGROUND_COLOR);
            ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // --- NEW: Recalculate Carousel Position on Resize (Now with robust error handling) ---
            if (mainCarouselController && carouselsInitialized) {
                try {
                    // We only need to trigger a re-position, no index change
                    const currentIndex = mainCarouselController.getCurrentIndex();
                    mainCarouselController.update(currentIndex, false);
                } catch (e) {
                    // Log the error but don't halt the entire page rendering
                    console.error("Error updating carousel position on resize:", e);
                }
            }
        }

        // Handles click/auto-respawn: spawns a single set of parallel strobes in a random direction
        function initStrobes(startX, startY) {
            if (STROBE_CONFIG.SPARK_TRIGGERS.RESET_SPAWN) {
                spawnSparks(startX, startY, STROBE_CONFIG.SPARK_COUNT * 2);
            }

            // Clear existing strobes with hole effects
            strobes.forEach((strobe) => {
                holes.push(new HoleEffect(strobe.x, strobe.y, strobe.color));
            });
            strobes = [];
            boundaryStrobes = [];

            const directions = [
                { dx: 1, dy: 0, axis: "vertical" },
                { dx: -1, dy: 0, axis: "vertical" },
                { dx: 0, dy: 1, axis: "horizontal" },
                { dx: 0, dy: -1, axis: "horizontal" },
            ];

            const selectedDirection =
                directions[Math.floor(Math.random() * directions.length)];
            const { dx: primaryDx, dy: primaryDy, axis } = selectedDirection;

            const count = STROBE_CONFIG.STROBE_SPAWN_COUNT;
            const offsetDistance = STROBE_CONFIG.STROBE_OFFSET_DISTANCE;
            const colors_rgb = THEMES[activeTheme].STROBE_COLORS_RGB; // Use the theme colors directly

            const offsets = [];
            const halfCount = count / 2;
            for (let i = 0; i < count; i++) {
                offsets.push((i - halfCount + 0.5) * offsetDistance);
            }

            for (let i = 0; i < count; i++) {
                let currentX = startX;
                let currentY = startY;

                if (axis === "horizontal") {
                    currentX += offsets[i];
                } else if (axis === "vertical") {
                    currentY += offsets[i];
                }

                // FIX: Cycle through the 4 colors correctly using the remainder of the index (i)
                const color = colors_rgb[i % colors_rgb.length];

                strobes.push(
                    new Strobe(currentX, currentY, primaryDx, primaryDy, color)
                );
            }

            lastStrobeStarted = Date.now();
            lastStrobeCleared = null;
        }

        // New function for the initial page load: 4 sets of strobes launching from all corners towards the center.
        function initCornerLaunch() {
            if (STROBE_CONFIG.SPARK_TRIGGERS.RESET_SPAWN) {
                // Sparks at the center for a 'boot-up' effect
                spawnSparks(
                    canvas.width / 2,
                    canvas.height / 2,
                    STROBE_CONFIG.SPARK_SPAWN_COUNT * 4
                );
            }

            // Clear existing strobes with hole effects
            strobes.forEach((strobe) => {
                holes.push(new HoleEffect(strobe.x, strobe.y, strobe.color));
            });
            strobes = [];
            boundaryStrobes = [];

            const colors_rgb = THEMES[activeTheme].STROBE_COLORS_RGB; // Use the theme colors directly

            // Define the 4 corner launch configurations: Start position (x,y), target direction (dx, dy), and axis for perpendicular offset
            const CORNER_LAUNCH_SETUPS = [
                // Top-Left (0,0) -> Direction (1, 1). Offset perpendicular (affects Y)
                { sx: 0, sy: 0, dx: 1, dy: 1, perpAxis: "y" },
                // Top-Right (W,0) -> Direction (-1, 1). Offset perpendicular (affects X)
                { sx: canvas.width, sy: 0, dx: -1, dy: 1, perpAxis: "x" },
                // Bottom-Left (0,H) -> Direction (1, -1). Offset perpendicular (affects X)
                { sx: 0, sy: canvas.height, dx: 1, dy: -1, perpAxis: "x" },
                // Bottom-Right (W,H) -> Direction (-1, -1). Offset perpendicular (affects Y)
                {
                    sx: canvas.width,
                    sy: canvas.height,
                    dx: -1,
                    dy: -1,
                    perpAxis: "y",
                },
            ];

            const count = STROBE_CONFIG.STROBE_SPAWN_COUNT;
            const offsetDistance = STROBE_CONFIG.STROBE_OFFSET_DISTANCE;

            const offsets = [];
            const halfCount = count / 2;
            for (let i = 0; i < count; i++) {
                // Calculate offsets: centered around 0
                offsets.push((i - halfCount + 0.5) * offsetDistance);
            }

            CORNER_LAUNCH_SETUPS.forEach((setup, setupIndex) => {
                const { sx, sy, dx, dy, perpAxis } = setup;

                for (let i = 0; i < count; i++) {
                    let currentX = sx;
                    let currentY = sy;
                    const offset = offsets[i];

                    // FIX: Cycle through the 4 colors correctly
                    const colorIndex = (setupIndex * count + i) % colors_rgb.length;
                    const color = colors_rgb[colorIndex];


                    // Apply offset perpendicular to the main direction (dx, dy)
                    if (perpAxis === "x") {
                        // Offset affects X coordinate, perpendicular to Y movement (TR, BL)
                        currentX += offset * -dx;
                    } else if (perpAxis === "y") {
                        // Offset affects Y coordinate, perpendicular to X movement (TL, BR)
                        currentY += offset * -dy;
                    }

                    // Push the new strobe with the calculated start position and direction
                    strobes.push(new Strobe(currentX, currentY, dx, dy, color));
                }
            });

            lastStrobeStarted = Date.now();
            lastStrobeCleared = null;
        }

        // Main animation loop that uses requestAnimationFrame time tracking
        function animate(currentTime) {
            requestAnimationFrame(animate);

            // Calculate deltaTime in seconds for frame-rate independence
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            // Only run logic if deltaTime is positive (after first frame) and reasonable
            if (deltaTime <= 0 || deltaTime > 0.1) return;

            // 1. Fade effect (same as before)
            const [r, g, b] = hexToRgb(BASE_BACKGROUND_COLOR);
            const FADE_ALPHA = activeTheme === "dark" ? 0.1 : 0.08;
            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${FADE_ALPHA})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const now = Date.now();

            const initialStrobeCount = strobes.length;
            const nextStrobes = [];

            // Update Main Strobes
            strobes.forEach((strobe) => {
                if (now - strobe.startTime > STROBE_CONFIG.STROBE_MAX_LIFE) {
                    holes.push(new HoleEffect(strobe.x, strobe.y, strobe.color));
                } else {
                    strobe.update(deltaTime);
                    strobe.draw();
                    nextStrobes.push(strobe);
                }
            });

            strobes = nextStrobes;

            // Auto-respawn logic
            if (initialStrobeCount > 0 && strobes.length === 0) {
                lastStrobeCleared = now;
            }

            if (
                lastStrobeCleared !== null &&
                now - lastStrobeCleared > STROBE_CONFIG.AUTO_SPAWN_DELAY
            ) {
                const randomX = Math.random() * canvas.width;
                const randomY = Math.random() * canvas.height;
                initStrobes(randomX, randomY);
            }

            // Update Boundary Strobes
            boundaryStrobes = boundaryStrobes.filter((strobe) => {
                strobe.update(deltaTime);
                strobe.draw();
                return !strobe.isComplete;
            });

            // Update Holes and Sparks
            holes = holes.filter((hole) => !hole.draw());
            sparks = sparks.filter((spark) => !spark.draw(deltaTime));
        }

        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        // Start the animation loop
        requestAnimationFrame(animate);
    </script>
</body>

</html>